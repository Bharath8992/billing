{% extends "invoice/base/base.html" %}
{% block content %}
<div class="row">
  <div class="col-xl-12 col-lg-7">
    <div class="card shadow mb-4">
      <div class="card-header py-3">
        <label class="m-0 font-weight-bold text-primary">Create Invoice</label>
      </div>

      <div class="card-body">
        <form method="post" action="">
          {% csrf_token %}

          <!-- Customer selection -->
          <div class="mb-3">
            <label class="form-label">Customer Name</label>
            <select id="customer_select" name="customer" class="form-control">
              <option value="">-- Select Customer --</option>
              {% for c in customers %}
                <option value="{{ c.id }}">{{ c.customer_name }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Auto-filled fields -->
          <div class="mb-3">
            <label class="form-label">Mobile</label>
            <input id="customer_number" type="text" class="form-control" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input id="customer_email" type="email" class="form-control" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">Status</label>
            <input id="customer_status" type="text" class="form-control" readonly>
          </div>

          <!-- Comments -->
          <div class="mb-3">
            <label class="form-label">Comments</label>
            <textarea name="comments" class="form-control"></textarea>
          </div>

          <!-- Service selection with images -->
          <div class="mb-3">
            <label class="form-label">Select Services</label>
            <div class="row">
              {% for p in products %}
              <div class="col-md-3 text-center mb-3">
                {% if p.services_image %}
                  <img src="{{ p.services_image.url }}" alt="{{ p.services_name }}" style="max-width:100%; height:150px; object-fit:cover;">
                {% else %}
                  <img src="/static/no-image.jpg" style="max-width:100%; height:150px;">
                {% endif %}
                <div>
                  <strong>{{ p.services_name }}</strong><br>
                  â‚¹{{ p.services_price }}
                </div>
                <input type="checkbox" name="products" value="{{ p.id }}"> Select
                <input type="number" name="quantities" min="1" value="1" class="form-control mt-2" style="width:80px; margin:auto;">
              </div>
              {% endfor %}
            </div>
          </div>

          <!-- Submit button -->
          <div class="text-center">
            <input type="submit" class="btn btn-success" value="Create Invoice">
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block custom_js %}
<script>
document.getElementById("customer_select").addEventListener("change", function () {
  const customerId = this.value;
  if (customerId) {
    fetch(`/get-customer-details/?customer_id=${customerId}`)
      .then(response => response.json())
      .then(data => {
        document.getElementById("customer_number").value = data.contact;
        document.getElementById("customer_email").value = data.email;
        document.getElementById("customer_status").value = data.status;
      });
  } else {
    document.getElementById("customer_number").value = "";
    document.getElementById("customer_email").value = "";
    document.getElementById("customer_status").value = "";
  }
});
</script>
{% endblock %}
